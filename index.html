<!doctype html>
<html>

<head>
    <script src="./scripts/jquery.min.js"></script>
    <script src="./scripts/jspsych.js"></script>
    <script src="./plugins/blink-test-plugin.js"></script>

    <link rel="stylesheet" href="./styles/jspsych.css"/>
    <link rel="stylesheet" href="./styles/blink-test.css"/>
</head>
<body>
<form id="surveyForm" class="text-center">
    Subject First name:<br>
    <input type="text" id="firstname"><br>
    Subject Last name:<br>
    <input type="text" id="lastname"><br>
    Experiment Name:<br>
    <input type="text" id="experiment"><br>
    <button type="submit" id="submit"> Submit</button>
</form>

<div id="console"></div>

</body>
<script>
    $(document).ready(function () {


        var block_1 = {
            type: 'blink-test',
            onSample: function () {

                $.ajax({
                    url: "/collectSample",
                    success: function (result) {
                        console.log("got a sample");
                    },
                    error: function (e) {
                        console.log("error collecting sample", e.message);
                    }
                })},

            onFinish: function(){
              $.ajax({ url: "/endExperiment",
                        success: function(){
                          console.log("saved");
                        },
                        error:function(err){
                          console.log("failed to save");
                        }
                      });
            }

          };



        $("#surveyForm").submit(function (e) {

            e.preventDefault();
            console.log("wtf");
            var subjectInfo = {
                subject: $("#firstname").val() + "_" + $("#lastname").val(),
                test: "BlinkTest",
                sample_duration:1,
                iter: 1
            };

            $("#surveyForm").remove();

            $("body").append(
                "<div style='align-content: center' id='jspsych-target'></div>");


            $.ajax({
                url: '/startExperiment',
                data: subjectInfo,
                dataType: 'json',
                success: function () {

                    jsPsych.init({
                        display_element: $('#jspsych-target'),
                        timeline: [block_1],
                        on_finish: function () {
                            jsPsych.data.displayData();

                        }
                    });
                },
                error: function () {
                    console.log("Super man");
                }
            });

        });
    });//document closure

    /*
     "<h2 id='loader'>Connecting to HEADSET</h2>" +
     $.ajax({
     url: '/connectHeadset',
     success: function (result) {
     $("#console").text("DUDE WE IN HERE");
     console.log("we turned on the headset");
     console.log(result);
     $("#loader").empty();
     $("#loader").text("Starting experiment");
     $.ajax({
     url: "/startExperiment",
     data: subjectInfo,
     dataType: "json",
     success: function(result){








     },

     error:function(e){
     console.log("error starting experiment")
     }
     });


     },
     error:function(e){
     console.log("Error connecting to headset", e.message);

     }


     });

     });
     });//document closure
     */

</script>

</html>
