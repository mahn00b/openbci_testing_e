<!doctype html>
<html>

<head>
    <script src="./scripts/jquery.min.js"></script>
    <script src="./scripts/jspsych.js"></script>
    <script src="./plugins/blink-test-plugin.js"></script>

    <link rel="stylesheet" href="./styles/jspsych.css"/>
    <link rel="stylesheet" href="./styles/blink-test.css"/>
</head>
<body>
<form id="surveyForm">
    Subject First name:<br>
    <input type="text" id="firstname"><br>
    Subject Last name:<br>
    <input type="text" id="lastname"><br>
    Experiment Name:<br>
    <input type="text" id="experiment"><br>
    <button type="submit" id="submit"> Submit</button>
</form>


</body>
<script>
    $(document).ready(function () {
        $("#surveyForm").submit(function (e) {
            event.preventDefault();

            var subjectInfo = {
                subject: $("#firstname").text() + " " + $("#lastname").text(),
                test: "BlinkTest",
                iter: 1
            };

            $("#surveyForm").remove();

            $("body").append("<h2 id='loader'>Connecting to HEADSET</h2>" +
                "<div style='align-content: center' id='jspsych-target'></div>");


            $.get('/connectHeadset', function (result) {
                console.log("we turn on the headset");


                $.get('/startExperiment', subjectInfo, function (e) {

                    var block_1 = {
                        type: 'blink-test',
                        onSample: function () {

                            $.get('/collectSample');

                        }


                    };

                    jsPsych.init({
                        display_element: $('#jspsych-target'),
                        timeline: [block_1],
                        on_finish: function () {
                            jsPsych.data.displayData();
                        }
                    });


                });


            });


        });


    });//document closure


</script>

</html>
